<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <!--
    Veterinary-specific enhancement of OrderWidget template for Odoo 18
    Shows membership status using NEW vet.pet.membership model
    -->
    <t t-inherit="point_of_sale.ProductScreen" t-inherit-mode="extension">
        <!-- This template inheritance is intentionally empty as no ProductScreen changes needed -->
    </t>

    <!--
    Veterinary-specific enhancement of OrderWidget template for Odoo 18
    Updated to work with NEW membership model (vet.pet.membership)
    -->
    <t t-inherit="point_of_sale.OrderWidget" t-inherit-mode="extension">

        <!--
        Veterinary Enhancement - Add membership status display using NEW membership model
        -->
        <xpath expr="//div[hasclass('order-summary')]" position="after">
            <!-- Only show membership info if partner exists and we can check membership -->
            <t t-if="order and order.get_partner() and order.get_partner().is_pet_owner">
                <t t-set="partner" t-value="order.get_partner()"/>

                <div class="partner-membership-status mt-2 p-2 bg-light rounded">
                    <!-- Membership icon and label with proper accessibility -->
                    <small class="text-muted">
                        <i class="fa fa-star me-1"
                           role="img"
                           aria-label="Membership Status"
                           title="Pet Owner Membership"/>

                        <!-- NEW: Check membership using vet.pet.membership model -->
                        <t t-if="partner.pet_membership_count and partner.pet_membership_count > 0">
                             <span class="text-success">Active Pet Memberships (</span>
                            <span class="text-success" t-esc="partner.pet_membership_count"/>
                            <span class="text-success">)</span>
                        </t>

                        <!-- No memberships -->
                        <t t-else="">
                             <span class="text-muted">No Active Memberships</span>
                        </t>
                    </small>
                </div>
            </t>
        </xpath>

    </t>

</templates>