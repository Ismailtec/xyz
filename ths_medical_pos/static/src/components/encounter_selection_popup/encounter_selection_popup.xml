<?xml version="1.0" encoding="UTF-8"?>
<templates id="templates" xml:space="preserve">
  <t t-name="ths_medical_pos.EncounterSelectionPopup">
    <Dialog title="props.title">
      <!-- Encounters list -->
        <div class="mb-2 d-flex flex-column gap-2" style="max-height: 400px; overflow-y: auto;">
        <t t-foreach="props.encounters" t-as="encounter" t-key="encounter.id">
          <button class="btn btn-outline-primary text-start p-3"
                  t-on-click="() => this.confirmSelection(encounter)"
                  style="border-radius: 8px;">
            <div class="d-flex flex-column gap-1">
              <!-- Encounter name and date -->
                <div class="d-flex justify-content-between align-items-center">
                <strong class="text-primary" t-esc="encounter.name"/>
                    <small class="text-muted" t-esc="encounter.encounter_date"/>
              </div>

                <!-- Partner information - Now properly formatted as [id, name] -->
                <div class="d-flex align-items-center">
                <i class="fa fa-user me-2 text-secondary"/>
                    <span class="fw-medium">
                  <t t-if="encounter.partner_id" t-esc="encounter.partner_id[1]"/>
                        <t t-else="">No Partner</t>
                </span>
              </div>

                <!-- Patient information - Now properly formatted as [[id, name], [id, name]] -->
                <t t-if="encounter.patient_ids and encounter.patient_ids.length">
                <div class="d-flex align-items-start">
                  <i class="fa fa-users me-2 text-secondary mt-1"/>
                    <div>
                    <small class="text-muted">Patients: </small>
                        <t t-foreach="encounter.patient_ids" t-as="patient" t-key="patient[0]">
                      <span class="badge bg-light text-dark me-1" t-esc="patient[1]"/>
                    </t>
                  </div>
                </div>
              </t>

                <!-- Practitioner information - Now properly formatted as [id, name] -->
                <t t-if="encounter.practitioner_id">
                <div class="d-flex align-items-center">
                  <i class="fa fa-user-md me-2 text-secondary"/>
                    <small>
                    <span class="text-muted">Dr. </span>
                        <span t-esc="encounter.practitioner_id[1]"/>
                  </small>
                </div>
              </t>

                <!-- Room information - Now properly formatted as [id, name] -->
                <t t-if="encounter.room_id">
                <div class="d-flex align-items-center">
                  <i class="fa fa-home me-2 text-secondary"/>
                    <small>
                    <span class="text-muted">Room: </span>
                        <span t-esc="encounter.room_id[1]"/>
                  </small>
                </div>
              </t>

                <!-- State badge -->
                <div class="d-flex justify-content-end">
                <span t-attf-class="badge bg-{{ encounter.state === 'done' ? 'success' : encounter.state === 'in_progress' ? 'primary' : 'secondary' }}"
                      t-esc="encounter.state"/>
              </div>
            </div>
          </button>
        </t>

            <!-- No encounters message -->
            <div t-if="!props.encounters.length" class="text-center p-4 text-muted">
          <i class="fa fa-info-circle fa-2x mb-2"/>
                <p>No medical encounters found</p>
        </div>
      </div>

        <!-- Footer with cancel button -->
        <t t-set-slot="footer">
        <button class="btn btn-secondary" t-on-click="cancel">
          <i class="fa fa-times me-1"/>
            <t t-esc="this.cancelLabel"/>
        </button>
      </t>
    </Dialog>
  </t>
</templates>